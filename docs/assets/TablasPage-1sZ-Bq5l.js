import{_ as y,S as g,U as C,N as D,V as n,Q as i,R as r,W as c,X as f,Y as b,Z as I,$ as h,a0 as w}from"./index-XoIn1gE0.js";import{Q as P,a as F,b as u}from"./QTable-nnRFspdU.js";import{Q as q}from"./QPage-WsjFXCsj.js";import{A as d}from"./ApiService-BDTTL-W2.js";import"./format-BrYk5Xrc.js";import"./position-engine-1Lx_OVdJ.js";import"./axios-B6xAlnh4.js";const A={data(){return{inventarios:[],loading:!0,saving:!1,deleting:!1,pagination:{page:1,rowsPerPage:10,sortBy:"id",descending:!1,rowsNumber:0},search:"",dialogVisible:!1,deleteDialogVisible:!1,currentItem:{},itemToDelete:null,columns:[{name:"codigo",label:"Código",field:"codigo",align:"left",sortable:!0},{name:"datos",label:"Datos",field:"datos",align:"left",sortable:!0},{name:"descripcion",label:"Descripción",field:"descripcion",align:"left",sortable:!0},{name:"area_funcional",label:"Área Funcional",field:e=>e.areaFuncional?.nombre??"—",align:"left",sortable:!0},{name:"sistema",label:"Sistema",field:e=>e.sistema?.sistema??"—",align:"left",sortable:!0},{name:"pais",label:"País",field:e=>e.pais?.nombre??"—",align:"left",sortable:!0},{name:"usuario",label:"Usuario",field:e=>e.usuario??e.user?.username??e.user?.name??"—",align:"left",sortable:!0},{name:"en_desarrollo",label:"En Desarrollo",field:e=>e.en_desarrollo??"—",align:"center",sortable:!0},{name:"capa",label:"Capa",field:"capa",align:"center",sortable:!0},{name:"actions",label:"Acciones",align:"center",field:"actions"}],paises:[],sistemas:[],areasFuncionales:[],datos:["Datos","Parámetros"],enDesarrollo:["Inactiva","En Desarrollo","Activa","Desuso"],capa:["Cliente","Core","País"]}},mounted(){this.fetchInventarios(),this.fetchPaises(),this.fetchSistemas(),this.fetchAreasFuncionales()},watch:{pagination:{deep:!0,handler(){this.fetchInventarios()}},search(){this.pagination.page=1,this.fetchInventarios()}},methods:{async fetchInventarios(){this.loading=!0;try{const e=this.pagination.rowsPerPage===0?this.pagination.rowsNumber:this.pagination.rowsPerPage,a={page:this.pagination.page,limit:e,sortBy:this.pagination.sortBy||"id",order:this.pagination.descending?"desc":"asc",search:this.search},s=await d.GetInventarios(a);this.inventarios=Array.isArray(s.items)?s.items:[],this.pagination.rowsNumber=Number(s.total)||0,s.page&&(this.pagination.page=Number(s.page)),s.limit&&(this.pagination.rowsPerPage=Number(s.limit))}catch(e){console.error("Error al obtener inventarios",e),this.inventarios=[],this.pagination.rowsNumber=0}finally{this.loading=!1}},onRequest({pagination:e}){const{page:a,rowsPerPage:s,sortBy:m,descending:l}=e;this.pagination.page=a,this.pagination.rowsPerPage=s,this.pagination.sortBy=m,this.pagination.descending=l,this.fetchInventarios()},async fetchPaises(){try{const e=await d.GetPaises();this.paises=Array.isArray(e.items)?e.items:[]}catch(e){console.error("Error al obtener los países:",e),this.paises=[]}},async fetchSistemas(){try{const e=await d.GetSistemas();this.sistemas=Array.isArray(e.items)?e.items:[]}catch(e){console.error("Error al obtener los sistemas:",e),this.sistemas=[]}},async fetchAreasFuncionales(){try{const e=await d.GetAreasFuncionales();this.areasFuncionales=Array.isArray(e.items)?e.items:[]}catch(e){console.error("Error al obtener las áreas:",e),this.areasFuncionales=[]}},onSearch(){this.pagination.page=1,this.fetchInventarios()},openCreateDialog(){this.currentItem={codigo:"",descripcion:"",datos:null,en_desarrollo:null,capa:null,areaFuncionalId:null,sistemaId:null,paisId:null},this.dialogVisible=!0},openEditDialog(e){this.currentItem={id:e.id,codigo:e.codigo,descripcion:e.descripcion,datos:e.datos??null,en_desarrollo:e.en_desarrollo??e.estado??null,capa:e.capa??null,areaFuncionalId:e.areaFuncionalId??e.areaFuncional?.id??null,sistemaId:e.sistemaId??e.sistema?.id??null,paisId:e.paisId??e.pais?.id??null},this.dialogVisible=!0},async saveItem(){this.saving=!0;try{const e=this.currentItem,a={codigo:e.codigo,descripcion:e.descripcion,datos:e.datos??null,en_desarrollo:e.en_desarrollo??null,capa:e.capa??null,areaFuncionalId:e.areaFuncionalId??null,sistemaId:e.sistemaId??null,paisId:e.paisId??null};e.id?await d.SetInventario(e.id,a):await d.CreateInventario(a),this.dialogVisible=!1,this.fetchInventarios()}catch(e){console.error("Error al guardar el inventario:",e)}finally{this.saving=!1}},confirmDelete(e){this.itemToDelete=e,this.deleteDialogVisible=!0},async deleteItem(){this.deleting=!0;try{await d.DeleteInventario(this.itemToDelete),this.deleteDialogVisible=!1,this.fetchInventarios()}catch(e){console.error("Error al eliminar el inventario:",e)}finally{this.deleting=!1}}}};function k(e,a,s,m,l,t){const p=g("q-col"),V=g("q-row");return D(),C(q,{class:"q-pa-md"},{default:n(()=>[i(P,{rows:l.inventarios||[],columns:l.columns||[],"row-key":"id",loading:l.loading,pagination:l.pagination,"onUpdate:pagination":a[1]||(a[1]=o=>l.pagination=o),"rows-per-page-label":"Registros por página:","rows-per-page-options":[10,25,50,0],"no-data-label":"Sin datos","no-results-label":"Sin resultados",onRequest:t.onRequest,class:"q-mb-md"},{"top-left":n(()=>[i(r,{label:"Crear",color:"secondary",onClick:t.openCreateDialog,class:"q-mr-md",rounded:""},null,8,["onClick"])]),"top-right":n(()=>[i(c,{filled:"",dense:"",debounce:"300",placeholder:"Buscar...",modelValue:l.search,"onUpdate:modelValue":a[0]||(a[0]=o=>l.search=o),onInput:t.onSearch,clearable:""},null,8,["modelValue","onInput"])]),"body-cell-actions":n(o=>[i(F,{props:o,class:"q-pa-none"},{default:n(()=>[i(r,{flat:"",color:"secondary",icon:"edit",onClick:v=>t.openEditDialog(o.row),class:"q-mr-xs",round:""},null,8,["onClick"]),i(r,{flat:"",color:"negative",icon:"delete",onClick:v=>t.confirmDelete(o.row.id),round:""},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading","pagination","onRequest"]),i(f,{modelValue:l.dialogVisible,"onUpdate:modelValue":a[11]||(a[11]=o=>l.dialogVisible=o)},{default:n(()=>[i(b,{class:"q-pa-md",style:{width:"800px"}},{default:n(()=>[i(I,null,{default:n(()=>[i(V,{class:"q-gutter-md"},{default:n(()=>[i(p,{cols:12,md:6},{default:n(()=>[i(c,{modelValue:l.currentItem.codigo,"onUpdate:modelValue":a[2]||(a[2]=o=>l.currentItem.codigo=o),label:"Código",outlined:""},null,8,["modelValue"]),i(c,{modelValue:l.currentItem.descripcion,"onUpdate:modelValue":a[3]||(a[3]=o=>l.currentItem.descripcion=o),label:"Descripción",outlined:""},null,8,["modelValue"]),i(u,{modelValue:l.currentItem.datos,"onUpdate:modelValue":a[4]||(a[4]=o=>l.currentItem.datos=o),label:"Datos",options:l.datos,outlined:""},null,8,["modelValue","options"]),i(u,{modelValue:l.currentItem.areaFuncionalId,"onUpdate:modelValue":a[5]||(a[5]=o=>l.currentItem.areaFuncionalId=o),label:"Área Funcional",options:l.areasFuncionales,"option-value":"id","option-label":"nombre","emit-value":"","map-options":"",outlined:""},null,8,["modelValue","options"])]),_:1}),i(p,{cols:12,md:6},{default:n(()=>[i(u,{modelValue:l.currentItem.sistemaId,"onUpdate:modelValue":a[6]||(a[6]=o=>l.currentItem.sistemaId=o),label:"Sistema",options:l.sistemas,"option-value":"id","option-label":"sistema","emit-value":"","map-options":"",outlined:""},null,8,["modelValue","options"]),i(u,{modelValue:l.currentItem.en_desarrollo,"onUpdate:modelValue":a[7]||(a[7]=o=>l.currentItem.en_desarrollo=o),label:"En Desarrollo",options:l.enDesarrollo,outlined:""},null,8,["modelValue","options"]),i(u,{modelValue:l.currentItem.capa,"onUpdate:modelValue":a[8]||(a[8]=o=>l.currentItem.capa=o),label:"Capa",options:l.capa,outlined:""},null,8,["modelValue","options"]),i(u,{modelValue:l.currentItem.paisId,"onUpdate:modelValue":a[9]||(a[9]=o=>l.currentItem.paisId=o),options:l.paises,label:"País","option-label":"nombre","option-value":"id","emit-value":"","map-options":"",outlined:""},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1}),i(h,{align:"right"},{default:n(()=>[i(r,{onClick:t.saveItem,color:"secondary",label:"Guardar",loading:l.saving},null,8,["onClick","loading"]),i(r,{onClick:a[10]||(a[10]=o=>l.dialogVisible=!1),color:"negative",label:"Cancelar",flat:""})]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(f,{modelValue:l.deleteDialogVisible,"onUpdate:modelValue":a[13]||(a[13]=o=>l.deleteDialogVisible=o)},{default:n(()=>[i(b,{class:"q-pa-md"},{default:n(()=>[i(I,null,{default:n(()=>[...a[14]||(a[14]=[w("¿Estás seguro de que deseas eliminar este registro?",-1)])]),_:1}),i(h,{align:"right"},{default:n(()=>[i(r,{onClick:t.deleteItem,color:"negative",label:"Eliminar",loading:l.deleting},null,8,["onClick","loading"]),i(r,{onClick:a[12]||(a[12]=o=>l.deleteDialogVisible=!1),color:"secondary",label:"Cancelar",flat:""})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const x=y(A,[["render",k],["__scopeId","data-v-4b298059"]]);export{x as default};
