import{_ as b,U as I,N as y,V as l,Q as a,R as n,W as m,X as c,Y as g,Z as p,$ as f,a0 as V}from"./index-XoIn1gE0.js";import{Q as w,a as C}from"./QTable-nnRFspdU.js";import{Q as S}from"./QPage-WsjFXCsj.js";import{A as u}from"./ApiService-BDTTL-W2.js";import"./format-BrYk5Xrc.js";import"./position-engine-1Lx_OVdJ.js";import"./axios-B6xAlnh4.js";const _={name:"SistemasPage",data(){return{sistemas:[],loading:!0,saving:!1,deleting:!1,pagination:{page:1,rowsPerPage:10,sortBy:"id",descending:!1,rowsNumber:0},search:"",dialogVisible:!1,deleteDialogVisible:!1,currentItem:{},itemToDelete:null,columns:[{name:"cod_area_funcional",label:"Código Área Funcional",field:"cod_area_funcional",align:"left",sortable:!0},{name:"cod_sistema",label:"Código Sistema",field:"cod_sistema",align:"left",sortable:!0},{name:"corr",label:"Correlativo",field:"corr",align:"left",sortable:!0},{name:"sistema",label:"Sistema",field:"sistema",align:"left",sortable:!0},{name:"actions",label:"Acciones",field:"actions",align:"center"}]}},mounted(){this.fetchSistemas()},watch:{pagination:{deep:!0,handler(){this.fetchSistemas()}},search(){this.pagination.page=1,this.fetchSistemas()}},methods:{isRequired(i){return!!(i&&String(i).trim())||"Este campo es obligatorio"},isInt(i){return Number.isInteger(Number(i))?!0:"Ingrese un entero válido"},async fetchSistemas(){this.loading=!0;try{const i=this.pagination.rowsPerPage===0?this.pagination.rowsNumber:this.pagination.rowsPerPage,e={page:this.pagination.page,limit:i,sortBy:this.pagination.sortBy||"id",order:this.pagination.descending?"desc":"asc",search:this.search},o=await u.GetSistemas(e);this.sistemas=Array.isArray(o.items)?o.items:[],this.pagination.rowsNumber=Number(o.total)||0,o.page&&(this.pagination.page=Number(o.page)),o.limit&&(this.pagination.rowsPerPage=Number(o.limit))}catch(i){console.error("Error al obtener los sistemas:",i),this.$q?.notify?.({type:"negative",message:"No se pudieron cargar los sistemas"}),this.sistemas=[],this.pagination.rowsNumber=0}finally{this.loading=!1}},onRequest({pagination:i}){const{page:e,rowsPerPage:o,sortBy:d,descending:t}=i;this.pagination.page=e,this.pagination.rowsPerPage=o,this.pagination.sortBy=d,this.pagination.descending=t,this.fetchSistemas()},onSearch(){this.pagination.page=1,this.fetchSistemas()},openCreateDialog(){this.currentItem={cod_area_funcional:null,cod_sistema:null,corr:null,sistema:""},this.dialogVisible=!0},openEditDialog(i){this.currentItem={id:i.id,cod_area_funcional:Number(i.cod_area_funcional),cod_sistema:Number(i.cod_sistema),corr:Number(i.corr),sistema:(i.sistema||"").trim()},this.dialogVisible=!0},async saveItem(){this.saving=!0;try{if(!this.isInt(this.currentItem.cod_area_funcional))throw new Error("Código Área Funcional inválido");if(!this.isInt(this.currentItem.cod_sistema))throw new Error("Código Sistema inválido");if(!this.isInt(this.currentItem.corr))throw new Error("Correlativo inválido");if(!this.isRequired(this.currentItem.sistema))throw new Error("El nombre del sistema es obligatorio");const i={cod_area_funcional:Number(this.currentItem.cod_area_funcional),cod_sistema:Number(this.currentItem.cod_sistema),corr:Number(this.currentItem.corr),sistema:(this.currentItem.sistema||"").trim()};this.currentItem.id?await u.SetSistemas(this.currentItem.id,i):await u.CreateSistemas(i),this.dialogVisible=!1,this.fetchSistemas(),this.$q?.notify?.({type:"positive",message:"Sistema guardado"})}catch(i){console.error("Error al guardar el sistema:",i);const e=i?.response?.data?.message||i.message||"Error al guardar";this.$q?.notify?.({type:"negative",message:e})}finally{this.saving=!1}},confirmDelete(i){this.itemToDelete=i,this.deleteDialogVisible=!0},async deleteItem(){this.deleting=!0;try{await u.DeleteSistemas(this.itemToDelete),this.deleteDialogVisible=!1,this.fetchSistemas(),this.$q?.notify?.({type:"positive",message:"Sistema eliminado"})}catch(i){console.error("Error al eliminar el sistema:",i),this.$q?.notify?.({type:"negative",message:"No se pudo eliminar"})}finally{this.deleting=!1}}}};function v(i,e,o,d,t,r){return y(),I(S,{class:"q-pa-md"},{default:l(()=>[a(w,{rows:t.sistemas||[],columns:t.columns||[],"row-key":"id",loading:t.loading,pagination:t.pagination,"onUpdate:pagination":e[1]||(e[1]=s=>t.pagination=s),"rows-per-page-options":[10,25,50,0],"rows-per-page-label":"Registros por página:","no-data-label":"Sin datos","no-results-label":"Sin resultados",onRequest:r.onRequest,class:"q-mb-md"},{"top-left":l(()=>[a(n,{label:"Crear Nuevo Sistema",color:"secondary",onClick:r.openCreateDialog,rounded:""},null,8,["onClick"])]),"top-right":l(()=>[a(m,{filled:"",dense:"",debounce:"300",placeholder:"Buscar...",modelValue:t.search,"onUpdate:modelValue":e[0]||(e[0]=s=>t.search=s),onInput:r.onSearch,clearable:""},null,8,["modelValue","onInput"])]),"body-cell-actions":l(s=>[a(C,{props:s,class:"q-pa-none"},{default:l(()=>[a(n,{flat:"",color:"secondary",icon:"edit",onClick:h=>r.openEditDialog(s.row),class:"q-mr-xs",round:""},null,8,["onClick"]),a(n,{flat:"",color:"negative",icon:"delete",onClick:h=>r.confirmDelete(s.row.id),round:""},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading","pagination","onRequest"]),a(c,{modelValue:t.dialogVisible,"onUpdate:modelValue":e[8]||(e[8]=s=>t.dialogVisible=s)},{default:l(()=>[a(g,{class:"q-pa-md",style:{width:"400px"}},{default:l(()=>[a(p,{class:"q-gutter-sm"},{default:l(()=>[a(m,{modelValue:t.currentItem.cod_area_funcional,"onUpdate:modelValue":e[2]||(e[2]=s=>t.currentItem.cod_area_funcional=s),modelModifiers:{number:!0},type:"number",label:"Código Área Funcional",outlined:"",rules:[r.isInt]},null,8,["modelValue","rules"]),a(m,{modelValue:t.currentItem.cod_sistema,"onUpdate:modelValue":e[3]||(e[3]=s=>t.currentItem.cod_sistema=s),modelModifiers:{number:!0},type:"number",label:"Código Sistema",outlined:"",rules:[r.isInt]},null,8,["modelValue","rules"]),a(m,{modelValue:t.currentItem.corr,"onUpdate:modelValue":e[4]||(e[4]=s=>t.currentItem.corr=s),modelModifiers:{number:!0},type:"number",label:"Correlativo",outlined:"",rules:[r.isInt]},null,8,["modelValue","rules"]),a(m,{modelValue:t.currentItem.sistema,"onUpdate:modelValue":[e[5]||(e[5]=s=>t.currentItem.sistema=s),e[6]||(e[6]=s=>t.currentItem.sistema=(s||"").trim())],label:"Sistema",outlined:"",rules:[r.isRequired]},null,8,["modelValue","rules"])]),_:1}),a(f,{align:"right"},{default:l(()=>[a(n,{onClick:r.saveItem,color:"primary",label:"Guardar",loading:t.saving},null,8,["onClick","loading"]),a(n,{flat:"",onClick:e[7]||(e[7]=s=>t.dialogVisible=!1),color:"secondary",label:"Cancelar"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(c,{modelValue:t.deleteDialogVisible,"onUpdate:modelValue":e[10]||(e[10]=s=>t.deleteDialogVisible=s)},{default:l(()=>[a(g,{class:"q-pa-md"},{default:l(()=>[a(p,null,{default:l(()=>[...e[11]||(e[11]=[V("¿Estás seguro que deseas eliminar este sistema?",-1)])]),_:1}),a(f,{align:"right"},{default:l(()=>[a(n,{onClick:r.deleteItem,color:"negative",label:"Eliminar",loading:t.deleting},null,8,["onClick","loading"]),a(n,{flat:"",onClick:e[9]||(e[9]=s=>t.deleteDialogVisible=!1),color:"secondary",label:"Cancelar"})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const B=b(_,[["render",v],["__scopeId","data-v-87b6086e"]]);export{B as default};
