import{_ as b,U as V,N as y,V as o,Q as i,R as r,W as u,X as g,Y as m,Z as p,$ as f,a0 as w}from"./index-XoIn1gE0.js";import{Q as C,a as A}from"./QTable-nnRFspdU.js";import{Q as D}from"./QPage-WsjFXCsj.js";import{A as d}from"./ApiService-BDTTL-W2.js";import"./format-BrYk5Xrc.js";import"./position-engine-1Lx_OVdJ.js";import"./axios-B6xAlnh4.js";const I={data(){return{areasFuncionales:[],loading:!0,saving:!1,deleting:!1,pagination:{page:1,rowsPerPage:10,sortBy:"id",descending:!1,rowsNumber:0},search:"",dialogVisible:!1,deleteDialogVisible:!1,currentItem:{},itemToDelete:null,columns:[{name:"codigo",label:"Código",field:"codigo",align:"left",sortable:!0},{name:"nombre",label:"Descripción",field:"nombre",align:"left",sortable:!0},{name:"actions",label:"Acciones",field:"actions",align:"center"}]}},mounted(){this.fetchAreasFuncionales()},watch:{pagination:{deep:!0,handler(){this.fetchAreasFuncionales()}},search(){this.pagination.page=1,this.fetchAreasFuncionales()}},methods:{async fetchAreasFuncionales(){this.loading=!0;try{const n=this.pagination.rowsPerPage===0?this.pagination.rowsNumber:this.pagination.rowsPerPage,e={page:this.pagination.page,limit:n,sortBy:this.pagination.sortBy||"id",order:this.pagination.descending?"desc":"asc",search:this.search},t=await d.GetAreasFuncionales(e);this.areasFuncionales=Array.isArray(t.items)?t.items:[],this.pagination.rowsNumber=Number(t.total)||0,t.page&&(this.pagination.page=Number(t.page)),t.limit&&(this.pagination.rowsPerPage=Number(t.limit))}catch(n){console.error("Error al obtener las áreas funcionales:",n),this.areasFuncionales=[],this.pagination.rowsNumber=0}finally{this.loading=!1}},onRequest({pagination:n}){const{page:e,rowsPerPage:t,sortBy:c,descending:a}=n;this.pagination.page=e,this.pagination.rowsPerPage=t,this.pagination.sortBy=c,this.pagination.descending=a,this.fetchAreasFuncionales()},onSearch(){this.pagination.page=1,this.fetchAreasFuncionales()},openCreateDialog(){this.currentItem={},this.dialogVisible=!0},openEditDialog(n){this.currentItem={...n},this.dialogVisible=!0},async saveItem(){this.saving=!0;try{this.currentItem.id?await d.SetAreasFuncionales(this.currentItem.id,this.currentItem):await d.CreateAreasFuncionales(this.currentItem),this.dialogVisible=!1,this.fetchAreasFuncionales()}catch(n){console.error("Error al guardar el área funcional:",n)}finally{this.saving=!1}},confirmDelete(n){this.itemToDelete=n,this.deleteDialogVisible=!0},async deleteItem(){this.deleting=!0;try{await d.DeleteAreasFuncionales(this.itemToDelete),this.deleteDialogVisible=!1,this.fetchAreasFuncionales()}catch(n){console.error("Error al eliminar el área funcional:",n)}finally{this.deleting=!1}}}};function F(n,e,t,c,a,s){return y(),V(D,{class:"q-pa-md"},{default:o(()=>[i(C,{rows:a.areasFuncionales||[],columns:a.columns||[],"row-key":"id",loading:a.loading,pagination:a.pagination,"onUpdate:pagination":e[1]||(e[1]=l=>a.pagination=l),"rows-per-page-label":"Registros por página:","rows-per-page-options":[10,25,50,0],"binary-state-sort":"","no-data-label":"Sin datos","no-results-label":"Sin resultados",onRequest:s.onRequest,class:"q-mb-md"},{"top-left":o(()=>[i(r,{label:"Crear Nueva Área Funcional",color:"secondary",onClick:s.openCreateDialog,class:"q-mb-md",rounded:""},null,8,["onClick"])]),"top-right":o(()=>[i(u,{filled:"",dense:"",debounce:"300",placeholder:"Buscar...",modelValue:a.search,"onUpdate:modelValue":e[0]||(e[0]=l=>a.search=l),onInput:s.onSearch,clearable:""},null,8,["modelValue","onInput"])]),"body-cell-actions":o(l=>[i(A,{props:l,class:"q-pa-none"},{default:o(()=>[i(r,{flat:"",color:"secondary",icon:"edit",onClick:h=>s.openEditDialog(l.row),class:"q-mr-xs",round:""},null,8,["onClick"]),i(r,{flat:"",color:"negative",icon:"delete",onClick:h=>s.confirmDelete(l.row.id),round:""},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading","pagination","onRequest"]),i(g,{modelValue:a.dialogVisible,"onUpdate:modelValue":e[5]||(e[5]=l=>a.dialogVisible=l)},{default:o(()=>[i(m,{class:"q-pa-md",style:{"max-width":"520px"}},{default:o(()=>[i(p,null,{default:o(()=>[i(u,{modelValue:a.currentItem.codigo,"onUpdate:modelValue":e[2]||(e[2]=l=>a.currentItem.codigo=l),label:"Código del Área",outlined:""},null,8,["modelValue"]),i(u,{modelValue:a.currentItem.nombre,"onUpdate:modelValue":e[3]||(e[3]=l=>a.currentItem.nombre=l),label:"Descripción",outlined:""},null,8,["modelValue"])]),_:1}),i(f,{align:"right"},{default:o(()=>[i(r,{onClick:s.saveItem,color:"primary",label:"Guardar",loading:a.saving},null,8,["onClick","loading"]),i(r,{onClick:e[4]||(e[4]=l=>a.dialogVisible=!1),color:"secondary",label:"Cancelar",flat:""})]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(g,{modelValue:a.deleteDialogVisible,"onUpdate:modelValue":e[7]||(e[7]=l=>a.deleteDialogVisible=l)},{default:o(()=>[i(m,{class:"q-pa-md",style:{"max-width":"420px"}},{default:o(()=>[i(p,null,{default:o(()=>[...e[8]||(e[8]=[w("¿Estás seguro de que deseas eliminar esta área funcional?",-1)])]),_:1}),i(f,{align:"right"},{default:o(()=>[i(r,{onClick:s.deleteItem,color:"negative",label:"Eliminar",loading:a.deleting},null,8,["onClick","loading"]),i(r,{onClick:e[6]||(e[6]=l=>a.deleteDialogVisible=!1),color:"secondary",label:"Cancelar",flat:""})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const B=b(I,[["render",F],["__scopeId","data-v-df9e9f08"]]);export{B as default};
