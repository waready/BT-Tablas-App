import{_ as b,U as y,N as C,V as l,Q as o,R as r,W as g,X as u,Y as p,Z as c,$ as f,a0 as P}from"./index-DcNzsUF7.js";import{Q as V,a as w}from"./QTable-DWmyEls9.js";import{Q as I}from"./QPage-BCKFHM-u.js";import{A as d}from"./ApiService-8IPDuUih.js";import"./format-DzOdCpNH.js";import"./position-engine-CueN1TjT.js";import"./axios-7ATVxtma.js";const v={name:"PaisesPage",data(){return{paises:[],loading:!0,saving:!1,deleting:!1,pagination:{page:1,rowsPerPage:10,sortBy:"id",descending:!1,rowsNumber:0},search:"",dialogVisible:!1,deleteDialogVisible:!1,currentItem:{},itemToDelete:null,columns:[{name:"nombre",label:"Nombre",field:"nombre",align:"left",sortable:!0},{name:"isoCode",label:"Código ISO",field:i=>i.isoCode??"—",align:"left",sortable:!0},{name:"actions",label:"Acciones",field:"actions",align:"center"}]}},mounted(){this.fetchPaises()},watch:{pagination:{deep:!0,handler(){this.fetchPaises()}},search(){this.pagination.page=1,this.fetchPaises()}},methods:{formatIso(i){return String(i||"").toUpperCase().replace(/[^A-Z]/g,"").slice(0,3)},async fetchPaises(){this.loading=!0;try{const i=this.pagination.rowsPerPage===0?this.pagination.rowsNumber:this.pagination.rowsPerPage,e={page:this.pagination.page,limit:i,sortBy:this.pagination.sortBy||"id",order:this.pagination.descending?"desc":"asc",search:this.search},t=await d.GetPaises(e);this.paises=Array.isArray(t.items)?t.items:[],this.pagination.rowsNumber=Number(t.total)||0,t.page&&(this.pagination.page=Number(t.page)),t.limit&&(this.pagination.rowsPerPage=Number(t.limit))}catch(i){console.error("Error al obtener los países:",i),this.$q?.notify?.({type:"negative",message:"No se pudieron cargar los países"}),this.paises=[],this.pagination.rowsNumber=0}finally{this.loading=!1}},onRequest({pagination:i}){const{page:e,rowsPerPage:t,sortBy:m,descending:a}=i;this.pagination.page=e,this.pagination.rowsPerPage=t,this.pagination.sortBy=m,this.pagination.descending=a,this.fetchPaises()},onSearch(){this.pagination.page=1,this.fetchPaises()},openCreateDialog(){this.currentItem={nombre:"",isoCode:""},this.dialogVisible=!0},openEditDialog(i){this.currentItem={id:i.id,nombre:i.nombre||"",isoCode:this.formatIso(i.isoCode||"")},this.dialogVisible=!0},async saveItem(){this.saving=!0;try{const i=(this.currentItem.nombre||"").trim();if(!i)throw new Error("El nombre es obligatorio");const e=this.formatIso(this.currentItem.isoCode),t={nombre:i,isoCode:e.length?e:null};this.currentItem.id?await d.SetPaises(this.currentItem.id,t):await d.CreatePaises(t),this.dialogVisible=!1,this.fetchPaises(),this.$q?.notify?.({type:"positive",message:"País guardado"})}catch(i){console.error("Error al guardar el país:",i);const e=i?.response?.data?.message||i.message||"Error al guardar";this.$q?.notify?.({type:"negative",message:e})}finally{this.saving=!1}},confirmDelete(i){this.itemToDelete=i,this.deleteDialogVisible=!0},async deleteItem(){this.deleting=!0;try{await d.DeletePaises(this.itemToDelete),this.deleteDialogVisible=!1,this.fetchPaises(),this.$q?.notify?.({type:"positive",message:"País eliminado"})}catch(i){console.error("Error al eliminar el país:",i),this.$q?.notify?.({type:"negative",message:"No se pudo eliminar"})}finally{this.deleting=!1}}}};function D(i,e,t,m,a,n){return C(),y(I,{class:"q-pa-md"},{default:l(()=>[o(V,{rows:a.paises||[],columns:a.columns||[],"row-key":"id",loading:a.loading,pagination:a.pagination,"onUpdate:pagination":e[1]||(e[1]=s=>a.pagination=s),"rows-per-page-options":[10,25,50,0],"rows-per-page-label":"Registros por página:","no-data-label":"Sin datos","no-results-label":"Sin resultados",onRequest:n.onRequest,class:"q-mb-md"},{"top-left":l(()=>[o(r,{label:"Crear Nuevo País",color:"secondary",onClick:n.openCreateDialog,rounded:""},null,8,["onClick"])]),"top-right":l(()=>[o(g,{filled:"",dense:"",debounce:"300",placeholder:"Buscar...",modelValue:a.search,"onUpdate:modelValue":e[0]||(e[0]=s=>a.search=s),onInput:n.onSearch,clearable:""},null,8,["modelValue","onInput"])]),"body-cell-actions":l(s=>[o(w,{props:s,class:"q-pa-none"},{default:l(()=>[o(r,{flat:"",color:"secondary",icon:"edit",onClick:h=>n.openEditDialog(s.row),class:"q-mr-xs",round:""},null,8,["onClick"]),o(r,{flat:"",color:"negative",icon:"delete",onClick:h=>n.confirmDelete(s.row.id),round:""},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading","pagination","onRequest"]),o(u,{modelValue:a.dialogVisible,"onUpdate:modelValue":e[6]||(e[6]=s=>a.dialogVisible=s)},{default:l(()=>[o(p,{class:"q-pa-md",style:{width:"520px"}},{default:l(()=>[o(c,null,{default:l(()=>[o(g,{modelValue:a.currentItem.nombre,"onUpdate:modelValue":e[2]||(e[2]=s=>a.currentItem.nombre=s),label:"Nombre del País",outlined:"",rules:[s=>!!(s&&s.trim())||"El nombre es obligatorio"]},null,8,["modelValue","rules"]),o(g,{modelValue:a.currentItem.isoCode,"onUpdate:modelValue":[e[3]||(e[3]=s=>a.currentItem.isoCode=s),e[4]||(e[4]=s=>a.currentItem.isoCode=n.formatIso(s))],label:"Código ISO (2–3 letras, opcional)",outlined:"",counter:"",maxlength:"3","input-class":"text-uppercase",rules:[s=>!s||/^[A-Z]{2,3}$/.test(s)||"Use 2 o 3 letras, ej: PE o PER"]},null,8,["modelValue","rules"])]),_:1}),o(f,{align:"right"},{default:l(()=>[o(r,{onClick:n.saveItem,color:"primary",label:"Guardar",loading:a.saving},null,8,["onClick","loading"]),o(r,{flat:"",onClick:e[5]||(e[5]=s=>a.dialogVisible=!1),color:"secondary",label:"Cancelar"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(u,{modelValue:a.deleteDialogVisible,"onUpdate:modelValue":e[8]||(e[8]=s=>a.deleteDialogVisible=s)},{default:l(()=>[o(p,{class:"q-pa-md"},{default:l(()=>[o(c,null,{default:l(()=>[...e[9]||(e[9]=[P("¿Estás seguro de que deseas eliminar este país?",-1)])]),_:1}),o(f,{align:"right"},{default:l(()=>[o(r,{onClick:n.deleteItem,color:"negative",label:"Eliminar",loading:a.deleting},null,8,["onClick","loading"]),o(r,{flat:"",onClick:e[7]||(e[7]=s=>a.deleteDialogVisible=!1),color:"secondary",label:"Cancelar"})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const B=b(v,[["render",D],["__scopeId","data-v-a1a36c02"]]);export{B as default};
